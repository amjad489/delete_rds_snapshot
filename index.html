<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Delete rds snapshot by amjad489</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Delete rds snapshot</h1>
      <h2 class="project-tagline">Python Boto script to delete rds snapshots older than X days</h2>
      <a href="https://github.com/amjad489/delete_rds_snapshot" class="btn">View on GitHub</a>
      <a href="https://github.com/amjad489/delete_rds_snapshot/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/amjad489/delete_rds_snapshot/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="delete_rds_snapshot" class="anchor" href="#delete_rds_snapshot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>delete_rds_snapshot</h1>

<p>Boto script to delete rds snapshots older than X days</p>

<pre><code>usage: delete_rds_snapshots.py [-h] region rds_instance_name days action
positional arguments:
  region              US-EAST-1 or US-WEST-2
  rds_instance_name   ex: db-master-1
  days                X number of days snapshots need to be deleted
  action              list: prints all the available snapshots to delete
                      delete: delete all the snapshots which are older than the x days
optional arguments:
  -h, --help         show this help message and exit
</code></pre>

<p>for more scripts please visit <a href="https://cloudtutorialsblog.wordpress.com">https://cloudtutorialsblog.wordpress.com</a></p>

<pre><code>`import argparse
 import sys
 import boto.rds2.exceptions
 from datetime import datetime, timedelta


def delete_rds_snapshots(connobj, rds_instance, duration, action):
    conn = connobj
    delete_time = datetime.utcnow() - timedelta(days=duration)
    rds_snapshots = conn.describe_db_snapshots(db_instance_identifier=rds_instance)
    list_rds_snapshots = rds_snapshots['DescribeDBSnapshotsResponse']['DescribeDBSnapshotsResult']['DBSnapshots']
    for snapshots in list_rds_snapshots:
        if snapshots["Status"] == "available":
            create_time = datetime.fromtimestamp(snapshots["SnapshotCreateTime"]).strftime('%Y-%m-%d %H:%M:%S')
        if create_time &lt; delete_time.strftime('%Y-%m-%d %H:%M:%S'):
            if action == "list":
                print("Available snapshots: " + snapshots["DBSnapshotIdentifier"] +
                      ", " + datetime.fromtimestamp(snapshots["SnapshotCreateTime"]).strftime('%Y-%m-%d %H:%M:%S'))
            if action == "delete":
                conn.delete_db_snapshot(db_snapshot_identifier=snapshots["DBSnapshotIdentifier"])
                print(snapshots["DBSnapshotIdentifier"] + " Snapshot deleted succesfully!!")


def start_from_here(region, rds_instance_name, days, action):
    try:
        conn = boto.rds2.connect_to_region(region)
        delete_rds_snapshots(conn, rds_instance_name, int(days), action)
    except Exception as E:
        print E

if __name__ == "__main__":
    arg_parser = argparse.ArgumentParser("Boto script to delete rds snapshots older than X days")
    arg_parser.add_argument("region", help="US-EAST-1 or US-WEST-2")
    arg_parser.add_argument("rds_instance_name", help="ex: db-master-1")
    arg_parser.add_argument("days", help="X number of days snapshots need to be deleted")
    arg_parser.add_argument("action", help="list:      prints all the available snapshots to delete\n"
                                       "delete:    delete all the snapshots which are older than the x days")
    if len(sys.argv) &lt; 5:
        arg_parser.print_help()
        sys.exit(1)
    arguments = arg_parser.parse_args()
    start_from_here(arguments.region, arguments.rds_instance_name, arguments.days, arguments.action)
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/amjad489/delete_rds_snapshot">Delete rds snapshot</a> is maintained by <a href="https://github.com/amjad489">amjad489</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
